"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/paystack-webhook";
exports.ids = ["pages/api/paystack-webhook"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fpaystack-webhook&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cpaystack-webhook.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fpaystack-webhook&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cpaystack-webhook.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/../../node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/../../node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_paystack_webhook_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src\\pages\\api\\paystack-webhook.ts */ \"(api)/./src/pages/api/paystack-webhook.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_paystack_webhook_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_paystack_webhook_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/paystack-webhook\",\n        pathname: \"/api/paystack-webhook\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_paystack_webhook_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1yb3V0ZS1sb2FkZXIvaW5kZXguanM/a2luZD1QQUdFU19BUEkmcGFnZT0lMkZhcGklMkZwYXlzdGFjay13ZWJob29rJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGc3JjJTVDcGFnZXMlNUNhcGklNUNwYXlzdGFjay13ZWJob29rLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ21FO0FBQ25FO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywrREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsK0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vd2ViLWxhbmRpbmcvPzNiN2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3NyY1xcXFxwYWdlc1xcXFxhcGlcXFxccGF5c3RhY2std2ViaG9vay50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3BheXN0YWNrLXdlYmhvb2tcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9wYXlzdGFjay13ZWJob29rXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fpaystack-webhook&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cpaystack-webhook.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/pages/api/paystack-webhook.ts":
/*!*******************************************!*\
  !*** ./src/pages/api/paystack-webhook.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Disable the default body parser, as we need the raw body for signature verification\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n// Helper to read the raw body from the request\nasync function getRawBody(req) {\n    const chunks = [];\n    for await (const chunk of req){\n        chunks.push(chunk);\n    }\n    return Buffer.concat(chunks);\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const secret = process.env.PAYSTACK_SECRET_KEY;\n    const rawBody = await getRawBody(req);\n    const body = JSON.parse(rawBody.toString());\n    // 1. Verify the webhook signature to ensure it's from Paystack\n    const hash = crypto__WEBPACK_IMPORTED_MODULE_1___default().createHmac(\"sha512\", secret).update(rawBody).digest(\"hex\");\n    if (hash !== req.headers[\"x-paystack-signature\"]) {\n        console.error(\"Webhook Error: Invalid signature\");\n        return res.status(401).send(\"Invalid signature\");\n    }\n    // 2. Check the event type\n    if (body.event !== \"charge.success\") {\n        return res.status(200).send(\"Event not for successful charge, ignoring.\");\n    }\n    const eventData = body.data;\n    const { email } = eventData.customer;\n    const amount = eventData.amount / 100;\n    const currency = eventData.currency.toUpperCase();\n    try {\n        // 4. Create a Supabase admin client using the service_role key\n        const supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://pelpmuamrijexomewbqk.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n        // 5. Find the user's profile and currency ID\n        const { data: profile } = await supabaseAdmin.from(\"profiles\").select(\"id\").eq(\"email\", email).single();\n        if (!profile) throw new Error(`Webhook Error: Profile not found for email ${email}`);\n        const { data: currencyData } = await supabaseAdmin.from(\"currencies\").select(\"id\").eq(\"code\", currency).single();\n        if (!currencyData) throw new Error(`Webhook Error: Currency ${currency} not found`);\n        // 6. Find the user's wallet\n        const { data: wallet, error: walletError } = await supabaseAdmin.from(\"wallets\").select(\"id, balance\").eq(\"user_id\", profile.id).eq(\"currency_id\", currencyData.id).single();\n        if (walletError || !wallet) throw new Error(`Webhook Error: Wallet not found for user ${profile.id} in currency ${currency}`);\n        // 7. Atomically credit the user's wallet using a remote procedure call (RPC)\n        const newBalance = wallet.balance + amount;\n        const { error: updateError } = await supabaseAdmin.from(\"wallets\").update({\n            balance: newBalance\n        }).eq(\"id\", wallet.id);\n        if (updateError) throw new Error(`Webhook Error: Failed to credit wallet ${wallet.id}. Reason: ${updateError.message}`);\n        console.log(`SUCCESS: Credited ${amount} ${currency} to wallet ${wallet.id}. New balance: ${newBalance}.`);\n        // 8. Respond to Paystack to acknowledge receipt\n        return res.status(200).send({\n            status: \"success\"\n        });\n    } catch (error) {\n        console.error(error.message);\n        return res.status(500).send({\n            error: error.message\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YUgsT0FBT0ksT0FBTyxHQUFHakI7UUFDcEMsTUFBTSxFQUFFdEIsT0FBT3dDLFdBQVcsRUFBRSxHQUFHLE1BQU1mLGNBQ2xDSSxJQUFJLENBQUMsV0FDTGpCLE1BQU0sQ0FBQztZQUFFMkIsU0FBU0Q7UUFBVyxHQUM3QlAsRUFBRSxDQUFDLE1BQU1JLE9BQU9FLEVBQUU7UUFFckIsSUFBSUcsYUFBYSxNQUFNLElBQUlQLE1BQU0sQ0FBQyx1Q0FBdUMsRUFBRUUsT0FBT0UsRUFBRSxDQUFDLFVBQVUsRUFBRUcsWUFBWUMsT0FBTyxDQUFDLENBQUM7UUFFdEgxQixRQUFRMkIsR0FBRyxDQUFDLENBQUMsa0JBQWtCLEVBQUVwQixPQUFPLENBQUMsRUFBRUMsU0FBUyxXQUFXLEVBQUVZLE9BQU9FLEVBQUUsQ0FBQyxlQUFlLEVBQUVDLFdBQVcsQ0FBQyxDQUFDO1FBRXpHLGdEQUFnRDtRQUNoRCxPQUFPMUMsSUFBSUUsTUFBTSxDQUFDLEtBQUtrQixJQUFJLENBQUM7WUFBRWxCLFFBQVE7UUFBVTtJQUVsRCxFQUFFLE9BQU9FLE9BQVk7UUFDbkJlLFFBQVFmLEtBQUssQ0FBQ0EsTUFBTXlDLE9BQU87UUFDM0IsT0FBTzdDLElBQUlFLE1BQU0sQ0FBQyxLQUFLa0IsSUFBSSxDQUFDO1lBQUVoQixPQUFPQSxNQUFNeUMsT0FBTztRQUFDO0lBQ3JEO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWItbGFuZGluZy8uL3NyYy9wYWdlcy9hcGkvcGF5c3RhY2std2ViaG9vay50cz81ZDZiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcblxyXG4vLyBEaXNhYmxlIHRoZSBkZWZhdWx0IGJvZHkgcGFyc2VyLCBhcyB3ZSBuZWVkIHRoZSByYXcgYm9keSBmb3Igc2lnbmF0dXJlIHZlcmlmaWNhdGlvblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gIGFwaToge1xyXG4gICAgYm9keVBhcnNlcjogZmFsc2UsXHJcbiAgfSxcclxufTtcclxuXHJcbi8vIEhlbHBlciB0byByZWFkIHRoZSByYXcgYm9keSBmcm9tIHRoZSByZXF1ZXN0XHJcbmFzeW5jIGZ1bmN0aW9uIGdldFJhd0JvZHkocmVxOiBOZXh0QXBpUmVxdWVzdCk6IFByb21pc2U8QnVmZmVyPiB7XHJcbiAgICBjb25zdCBjaHVua3M6IEJ1ZmZlcltdID0gW107XHJcbiAgICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHJlcSkge1xyXG4gICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTtcclxuICAgIH1cclxuICAgIHJldHVybiBCdWZmZXIuY29uY2F0KGNodW5rcyk7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gJ1BPU1QnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5QQVlTVEFDS19TRUNSRVRfS0VZITtcclxuICBjb25zdCByYXdCb2R5ID0gYXdhaXQgZ2V0UmF3Qm9keShyZXEpO1xyXG4gIGNvbnN0IGJvZHkgPSBKU09OLnBhcnNlKHJhd0JvZHkudG9TdHJpbmcoKSk7XHJcblxyXG4gIC8vIDEuIFZlcmlmeSB0aGUgd2ViaG9vayBzaWduYXR1cmUgdG8gZW5zdXJlIGl0J3MgZnJvbSBQYXlzdGFja1xyXG4gIGNvbnN0IGhhc2ggPSBjcnlwdG8uY3JlYXRlSG1hYygnc2hhNTEyJywgc2VjcmV0KS51cGRhdGUocmF3Qm9keSkuZGlnZXN0KCdoZXgnKTtcclxuICBpZiAoaGFzaCAhPT0gcmVxLmhlYWRlcnNbJ3gtcGF5c3RhY2stc2lnbmF0dXJlJ10pIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1dlYmhvb2sgRXJyb3I6IEludmFsaWQgc2lnbmF0dXJlJyk7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoJ0ludmFsaWQgc2lnbmF0dXJlJyk7XHJcbiAgfVxyXG5cclxuICAvLyAyLiBDaGVjayB0aGUgZXZlbnQgdHlwZVxyXG4gIGlmIChib2R5LmV2ZW50ICE9PSAnY2hhcmdlLnN1Y2Nlc3MnKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoJ0V2ZW50IG5vdCBmb3Igc3VjY2Vzc2Z1bCBjaGFyZ2UsIGlnbm9yaW5nLicpO1xyXG4gIH1cclxuICBcclxuICBjb25zdCBldmVudERhdGEgPSBib2R5LmRhdGE7XHJcbiAgY29uc3QgeyBlbWFpbCB9ID0gZXZlbnREYXRhLmN1c3RvbWVyO1xyXG4gIGNvbnN0IGFtb3VudCA9IGV2ZW50RGF0YS5hbW91bnQgLyAxMDA7XHJcbiAgY29uc3QgY3VycmVuY3kgPSBldmVudERhdGEuY3VycmVuY3kudG9VcHBlckNhc2UoKTtcclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIDQuIENyZWF0ZSBhIFN1cGFiYXNlIGFkbWluIGNsaWVudCB1c2luZyB0aGUgc2VydmljZV9yb2xlIGtleVxyXG4gICAgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChcclxuICAgICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxyXG4gICAgICAgIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkhXHJcbiAgICApO1xyXG5cclxuICAgIC8vIDUuIEZpbmQgdGhlIHVzZXIncyBwcm9maWxlIGFuZCBjdXJyZW5jeSBJRFxyXG4gICAgY29uc3QgeyBkYXRhOiBwcm9maWxlIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmZyb20oJ3Byb2ZpbGVzJykuc2VsZWN0KCdpZCcpLmVxKCdlbWFpbCcsIGVtYWlsKS5zaW5nbGUoKTtcclxuICAgIGlmICghcHJvZmlsZSkgdGhyb3cgbmV3IEVycm9yKGBXZWJob29rIEVycm9yOiBQcm9maWxlIG5vdCBmb3VuZCBmb3IgZW1haWwgJHtlbWFpbH1gKTtcclxuXHJcbiAgICBjb25zdCB7IGRhdGE6IGN1cnJlbmN5RGF0YSB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5mcm9tKCdjdXJyZW5jaWVzJykuc2VsZWN0KCdpZCcpLmVxKCdjb2RlJywgY3VycmVuY3kpLnNpbmdsZSgpO1xyXG4gICAgaWYgKCFjdXJyZW5jeURhdGEpIHRocm93IG5ldyBFcnJvcihgV2ViaG9vayBFcnJvcjogQ3VycmVuY3kgJHtjdXJyZW5jeX0gbm90IGZvdW5kYCk7XHJcblxyXG4gICAgLy8gNi4gRmluZCB0aGUgdXNlcidzIHdhbGxldFxyXG4gICAgY29uc3QgeyBkYXRhOiB3YWxsZXQsIGVycm9yOiB3YWxsZXRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCd3YWxsZXRzJylcclxuICAgICAgICAuc2VsZWN0KCdpZCwgYmFsYW5jZScpXHJcbiAgICAgICAgLmVxKCd1c2VyX2lkJywgcHJvZmlsZS5pZClcclxuICAgICAgICAuZXEoJ2N1cnJlbmN5X2lkJywgY3VycmVuY3lEYXRhLmlkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgIGlmICh3YWxsZXRFcnJvciB8fCAhd2FsbGV0KSB0aHJvdyBuZXcgRXJyb3IoYFdlYmhvb2sgRXJyb3I6IFdhbGxldCBub3QgZm91bmQgZm9yIHVzZXIgJHtwcm9maWxlLmlkfSBpbiBjdXJyZW5jeSAke2N1cnJlbmN5fWApO1xyXG5cclxuICAgIC8vIDcuIEF0b21pY2FsbHkgY3JlZGl0IHRoZSB1c2VyJ3Mgd2FsbGV0IHVzaW5nIGEgcmVtb3RlIHByb2NlZHVyZSBjYWxsIChSUEMpXHJcbiAgICBjb25zdCBuZXdCYWxhbmNlID0gd2FsbGV0LmJhbGFuY2UgKyBhbW91bnQ7XHJcbiAgICBjb25zdCB7IGVycm9yOiB1cGRhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgnd2FsbGV0cycpXHJcbiAgICAgIC51cGRhdGUoeyBiYWxhbmNlOiBuZXdCYWxhbmNlIH0pXHJcbiAgICAgIC5lcSgnaWQnLCB3YWxsZXQuaWQpO1xyXG4gICAgXHJcbiAgICBpZiAodXBkYXRlRXJyb3IpIHRocm93IG5ldyBFcnJvcihgV2ViaG9vayBFcnJvcjogRmFpbGVkIHRvIGNyZWRpdCB3YWxsZXQgJHt3YWxsZXQuaWR9LiBSZWFzb246ICR7dXBkYXRlRXJyb3IubWVzc2FnZX1gKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyhgU1VDQ0VTUzogQ3JlZGl0ZWQgJHthbW91bnR9ICR7Y3VycmVuY3l9IHRvIHdhbGxldCAke3dhbGxldC5pZH0uIE5ldyBiYWxhbmNlOiAke25ld0JhbGFuY2V9LmApO1xyXG4gICAgXHJcbiAgICAvLyA4LiBSZXNwb25kIHRvIFBheXN0YWNrIHRvIGFja25vd2xlZGdlIHJlY2VpcHRcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7IHN0YXR1czogJ3N1Y2Nlc3MnIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5zZW5kKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgfVxyXG59Il0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsImNyeXB0byIsImNvbmZpZyIsImFwaSIsImJvZHlQYXJzZXIiLCJnZXRSYXdCb2R5IiwicmVxIiwiY2h1bmtzIiwiY2h1bmsiLCJwdXNoIiwiQnVmZmVyIiwiY29uY2F0IiwiaGFuZGxlciIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJQQVlTVEFDS19TRUNSRVRfS0VZIiwicmF3Qm9keSIsImJvZHkiLCJKU09OIiwicGFyc2UiLCJ0b1N0cmluZyIsImhhc2giLCJjcmVhdGVIbWFjIiwidXBkYXRlIiwiZGlnZXN0IiwiaGVhZGVycyIsImNvbnNvbGUiLCJzZW5kIiwiZXZlbnQiLCJldmVudERhdGEiLCJkYXRhIiwiZW1haWwiLCJjdXN0b21lciIsImFtb3VudCIsImN1cnJlbmN5IiwidG9VcHBlckNhc2UiLCJzdXBhYmFzZUFkbWluIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsInByb2ZpbGUiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJFcnJvciIsImN1cnJlbmN5RGF0YSIsIndhbGxldCIsIndhbGxldEVycm9yIiwiaWQiLCJuZXdCYWxhbmNlIiwiYmFsYW5jZSIsInVwZGF0ZUVycm9yIiwibWVzc2FnZSIsImxvZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/paystack-webhook.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fpaystack-webhook&preferredRegion=&absolutePagePath=.%2Fsrc%5Cpages%5Capi%5Cpaystack-webhook.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();